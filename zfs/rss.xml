<?xml version='1.0' encoding='UTF-8'?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" version="2.0"><channel><title>Pype's mental data lake - zfs posts</title><link>https://pype.dev/zfs-rss.xml</link><description>Pypeaday posts - zfs posts</description><atom:link href="https://pype.dev/zfs-rss.xml" rel="self"/><docs>http://www.rssboard.org/rss-specification</docs><generator>python-feedgen</generator><image><url>bitmoji.png</url><title>Pype's mental data lake - zfs posts</title><link>https://pype.dev/zfs-rss.xml</link></image><language>en</language><lastBuildDate>Sat, 25 Jun 2022 12:28:37 +0000</lastBuildDate><item><title>Nextcloud permissions with ZFS and Ansible-NAS</title><link>https://pype.dev/til/nextcloud-permissions-with-zfs-and-ansible-nas</link><description>As the nextcloud docs say... if you want to write to an external volume that You want to self-host your own cloud and use a smart file system for convenience...</description><content:encoded>&lt;h1 id="tldr"&gt;TL;DR&lt;/h1&gt;&lt;p&gt;As the nextcloud docs say... if you want to write to an external volume thatlocation has to be writeable by the user/group &lt;code&gt;www-data&lt;/code&gt; on the host system...so if that makes sense to you then this TIL probably isn't a ton of value.. ifnot however, read on :)&lt;/p&gt;&lt;h1 id="case-study"&gt;Case Study&lt;/h1&gt;&lt;p&gt;You want to self-host your own cloud and use a smart file system for convenience...Nextcloud and ZFS are pretty common goto answers for each of those problems.&lt;/p&gt;&lt;p&gt;My home NAS is built on ZFS and among other things I have a &lt;code&gt;zpool&lt;/code&gt; named&lt;code&gt;tank&lt;/code&gt; and nested in there is a &lt;code&gt;tank/nas&lt;/code&gt; dataset with several child zfsdatasets under that.&lt;/p&gt;&lt;p&gt;I want to use nextcloud mainly for auto-uploading photos from my wife's and my phones for automatic backups.The issue is that the nextcloud application (I run in Docker) is fixed as the&lt;code&gt;www-data&lt;/code&gt; user and so any volume/folder that you want nextcloud to write toneeds to be permissioned such that &lt;code&gt;www-data&lt;/code&gt; owns it... but I don't want&lt;code&gt;www-data&lt;/code&gt; to own everything in my NAS... so what's a girl to do?&lt;/p&gt;&lt;h1 id="solution"&gt;Solution&lt;/h1&gt;&lt;p&gt;Well, one way to go is to just utilize docker volumes, write the data in thecontainer to &lt;code&gt;/var/www/html&lt;/code&gt; and let that be the place your data backsup to.&lt;/p&gt;&lt;p&gt;I still wanted nextcloud to automatically write right to my NAS so I created a&lt;code&gt;nextcloud-upload&lt;/code&gt; directory inside of &lt;code&gt;tank/nas/media/photos&lt;/code&gt; (photos causethat's all that gets automatically uploaded)&lt;/p&gt;&lt;p&gt;Then I &lt;code&gt;chown -R www-data:www-data /tank/nas/media/photos/nextcloud-upload&lt;/code&gt; sothat just that sub-folder is owned by &lt;code&gt;www-data&lt;/code&gt;. Now everyone's happy!&lt;/p&gt;</content:encoded><guid isPermaLink="false">https://pype.dev/til/nextcloud-permissions-with-zfs-and-ansible-nas</guid><pubDate>Thu, 19 May 2022 00:00:00 +0000</pubDate></item></channel></rss>