<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width" name="viewport"/>
  <link href="/bitmoji.ico" rel="icon" type="image/png"/>
  <link href="https://pype.dev/til/tdarr-worker-nodes-share-the-cache/amp/" rel="amphtml"/>
  <meta content="$ilp.uphold.com/MGN2ni2YMXaQ" name="monetization" property="monetization"/>
  <!-- <link rel='stylesheet' href='/fonts.css' />
  <link rel='stylesheet' href='/archive-styles.css' />
  <link rel='stylesheet' href='/article.css' /> -->
  <link href="/main.css" rel="stylesheet"/>
  <link as="style" href="/one-dark.min.css" onload="this.onload=null;this.rel='stylesheet'" rel="preload"/>
  <link as="style" href="/furo-purge.min.css" onload="this.onload=null;this.rel='stylesheet'" rel="preload"/>
  <!-- <link rel="preload" href="/scroll.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> -->
  <noscript>
   <!-- <link rel='stylesheet' href='/scroll.css' /> -->
   <link href="/one-dark.min.css" rel="stylesheet"/>
   <link href="/furo-purge.min.css" rel="stylesheet"/>
  </noscript>
  <link href="bitmoji_48x48.png" rel="apple-touch-icon" sizes="48x48"/>
  <link href="bitmoji_72x72.png" rel="apple-touch-icon" sizes="72x72"/>
  <link href="bitmoji_96x96.png" rel="apple-touch-icon" sizes="96x96"/>
  <link href="bitmoji_144x144.png" rel="apple-touch-icon" sizes="144x144"/>
  <link href="bitmoji_192x192.png" rel="apple-touch-icon" sizes="192x192"/>
  <link href="bitmoji_256x256.png" rel="apple-touch-icon" sizes="256x256"/>
  <link href="bitmoji_384x384.png" rel="apple-touch-icon" sizes="384x384"/>
  <link href="bitmoji_512x512.png" rel="apple-touch-icon" sizes="512x512"/>
  <title>
   Tdarr worker nodes share the cache!
  </title>
  <meta content="article" name="og:type" property="og:type"/>
  <meta content="Nicholas Payne" name="og:author" property="og:author"/>
  <meta content="Nicholas Payne" name="og:site_name" property="og:site_name"/>
  <meta content="#3A5895" name="theme-color"/>
  <meta content="Nicholas Payne" name="og:author" property="og:author"/>
  <meta content="pypeaday@pm.me" name="og:author_email" property="og:author_email"/>
  <meta content="website" name="og:type" property="og:type"/>
  <meta content="When working with tdarr remote nodes, they need to have access not only to the To explain I I have an old Dell PowerEdge R610 as my main server running a live s" name="description" property="description"/>
  <meta content="When working with tdarr remote nodes, they need to have access not only to the To explain I I have an old Dell PowerEdge R610 as my main server running a live s" name="og:description" property="og:description"/>
  <meta content="When working with tdarr remote nodes, they need to have access not only to the To explain I I have an old Dell PowerEdge R610 as my main server running a live s" name="twitter:description" property="twitter:description"/>
  <meta content="Tdarr worker nodes share the cache! | Pypeaday" name="og:title" property="og:title"/>
  <meta content="Tdarr worker nodes share the cache! | Pypeaday" name="twitter:title" property="twitter:title"/>
  <meta content="/static/images/til/tdarr-worker-nodes-share-the-cache-og.png" name="og:image" property="og:image"/>
  <meta content="/static/images/til/tdarr-worker-nodes-share-the-cache-og.png" name="twitter:image" property="twitter:image"/>
  <meta content="1600" name="og:image:width" property="og:image:width"/>
  <meta content="900" name="og:image:width" property="og:image:width"/>
  <meta content="summary_large_image" name="twitter:card" property="twitter:card"/>
  <meta content="Pypeaday" name="og:site_name" property="og:site_name"/>
  <meta content="@pypeaday" name="twitter:creator" property="twitter:creator"/>
  <meta content="Tdarr worker nodes share the cache!" name="title" property="title"/>
  <meta content="markata 0.2.0" name="generator" property="generator"/>
  <link href="https://pype.dev/til/tdarr-worker-nodes-share-the-cache/" rel="canonical"/>
  <meta content="https://pype.dev/til/tdarr-worker-nodes-share-the-cache/" name="og:url" property="og:url"/>
  <link href="/manifest.json" rel="manifest"/>
  <meta content="/static/images/til/tdarr-worker-nodes-share-the-cache-og_250x140.png" name="og:sm_image" property="og:sm_image"/>
  <meta content="/static/images/til/tdarr-worker-nodes-share-the-cache-og_250x140.png" name="og:sm_image" property="og:sm_image"/>
 </head>
 <body>
  <nav>
   <ul>
    <li>
     <a href="/">
      Home
     </a>
    </li>
    <li>
     <a href="/archive/">
      Archive
     </a>
    </li>
    <li>
     <a aria-label="RSS" href="/rss.xml">
      <svg class="icon" height="16" viewbox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
       <path d="M 4 4.44 v 2.83 c 7.03 0 12.73 5.7 12.73 12.73 h 2.83 c 0 -8.59 -6.97 -15.56 -15.56 -15.56 Z m 0 5.66 v 2.83 c 3.9 0 7.07 3.17 7.07 7.07 h 2.83 c 0 -5.47 -4.43 -9.9 -9.9 -9.9 Z M 6.18 15.64 A 2.18 2.18 0 0 1 6.18 20 A 2.18 2.18 0 0 1 6.18 15.64" fill="currentColor">
       </path>
      </svg>
     </a>
    </li>
   </ul>
  </nav>
  <article class="blog-post h-entry">
   <!-- <div id='cover-wrapper'>
      <img src='/til/tdarr-worker-nodes-share-the-cache.webp' alt='cover image for article' />
    </div> -->
   <div id="title-wrapper">
    <a class="u-url" href="https://pype.dev/til/tdarr-worker-nodes-share-the-cache/">
     <h1 class="flair" id="title" style="text-align:right;z-index:2;padding-right:.2rem">
      Tdarr worker nodes share the cache!
     </h1>
    </a>
    <p>
     <time class="dt-published post-date" datetime="2022-05-25" style="text-align:right;z-index:2">
      2022-05-25
     </time>
    </p>
    <div class="h-card p-author" rel="author">
     <div class="content">
      <a class="p-name u-url" href="https://pype.dev/">
       <p>
        <span class="p-given-name">
         Nicholas
        </span>
        <span class="p-family-name">
         Payne
        </span>
       </p>
      </a>
      <p class="p-note">
       Goofing off
       <a href="https://twitter.com/pypeaday">
        @pypeaday
       </a>
      </p>
     </div>
    </div>
    <!-- edit -->
    <p>
     <a alt="edit post url" href="https://github.com/nicpayne713/mental-data-lake/edit/main/pages/blog/til/tdarr-worker-nodes-share-the-cache.md" title="edit this post">
      edit
      <span aria-label="" role="img">
       ✏️
      </span>
     </a>
    </p>
   </div>
   <!-- <h2 class='toc'>toc</h2> -->
   <!-- <div class="toc">
<ul>
<li><a href="#abcmeta">ABCMeta</a></li>
</ul>
</div>
 -->
   <div id="post-body">
    <p>
     When working with tdarr remote nodes, they need to have access not only to the
same libraries but also the same transcode cache as the server otherwise the
transcodes will fail...
    </p>
    <h1 id="network-setup">
     Network Setup
     <a alt="id" class="heading-permalink" href="#network-setup" title="link to #network-setup">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h1>
    <p>
     To explain I'll give a brief overview of my home setup
    </p>
    <p>
     I have an old Dell PowerEdge R610 as my main server running a live server distribution of Ubuntu.
I use ZFS for my NAS file system, and most of my datasets are accesible over my home network.
I have a Tdarr server running in a docker container on the R610.
    </p>
    <p>
     In my office I dailyi drive a gaming desktop with an Nvidia 2060 Super running Ubuntu as well.
On that desktop I am running a Tdarr node in a docker container. 
The container has access to the network folders with my media.
    </p>
    <h1 id="initial-magic">
     Initial Magic
     <a alt="id" class="heading-permalink" href="#initial-magic" title="link to #initial-magic">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h1>
    <p>
     When I spun up  a tdarr node on my desktop, the tdarr server running on my R610 automatically registered the node, which was freaking amazing.
That magic though spoiled me and I thought that I didn't need to read the rest of the docs...
    </p>
    <h1 id="initial-fail">
     Initial Fail
     <a alt="id" class="heading-permalink" href="#initial-fail" title="link to #initial-fail">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h1>
    <p>
     I setup a transcode cache directory on the R610 locally and a separate transcode cache on my desktop that the remote tdarr node would use.
Having them separated led to 2 main issues:
1. Transcodes were not being migrated back to my library properly
2. I was running out of disk space on my desktop because tdarr wasn't deleting the completed cache files properly.
    </p>
    <h1 id="the-fix">
     The Fix
     <a alt="id" class="heading-permalink" href="#the-fix" title="link to #the-fix">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h1>
    <p>
     Make a transcode cache directory accessible on my network, and give access to that directory to the docker container running my remote tdarr node.
    </p>
   </div>
   <hr/>
   <div id="show">
   </div>
  </article>
  <footer>
   <ul class="social">
    <li>
     <a href="https://twitter.com/pypeaday">
      twitter
     </a>
    </li>
    <li>
     <a href="https://www.linkedin.com/in/nicpayne713/">
      LinkedIn
     </a>
    </li>
    <li>
     <a href="https://github.com/nicpayne713">
      GitHub
     </a>
    </li>
    <li>
     <a href="https://www.twitch.tv/pypeaday">
      twitch
     </a>
    </li>
   </ul>
   <p>
    © 2022 - 2022
   </p>
  </footer>
 </body>
</html>