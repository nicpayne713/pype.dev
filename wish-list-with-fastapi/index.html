<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width" name="viewport"/>
  <link href="/bitmoji.ico" rel="icon" type="image/png"/>
  <link href="https://pype.dev/wish-list-with-fastapi/amp/" rel="amphtml"/>
  <meta content="$ilp.uphold.com/MGN2ni2YMXaQ" name="monetization" property="monetization"/>
  <!-- <link rel='stylesheet' href='/fonts.css' />
  <link rel='stylesheet' href='/archive-styles.css' />
  <link rel='stylesheet' href='/article.css' /> -->
  <link href="/main.css" rel="stylesheet"/>
  <link as="style" href="/one-dark.min.css" onload="this.onload=null;this.rel='stylesheet'" rel="preload"/>
  <link as="style" href="/furo-purge.min.css" onload="this.onload=null;this.rel='stylesheet'" rel="preload"/>
  <!-- <link rel="preload" href="/scroll.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> -->
  <noscript>
   <!-- <link rel='stylesheet' href='/scroll.css' /> -->
   <link href="/one-dark.min.css" rel="stylesheet"/>
   <link href="/furo-purge.min.css" rel="stylesheet"/>
  </noscript>
  <link href="bitmoji_48x48.png" rel="apple-touch-icon" sizes="48x48"/>
  <link href="bitmoji_72x72.png" rel="apple-touch-icon" sizes="72x72"/>
  <link href="bitmoji_96x96.png" rel="apple-touch-icon" sizes="96x96"/>
  <link href="bitmoji_144x144.png" rel="apple-touch-icon" sizes="144x144"/>
  <link href="bitmoji_192x192.png" rel="apple-touch-icon" sizes="192x192"/>
  <link href="bitmoji_256x256.png" rel="apple-touch-icon" sizes="256x256"/>
  <link href="bitmoji_384x384.png" rel="apple-touch-icon" sizes="384x384"/>
  <link href="bitmoji_512x512.png" rel="apple-touch-icon" sizes="512x512"/>
  <title>
   Wish-List-With-Fastapi
  </title>
  <meta content="article" name="og:type" property="og:type"/>
  <meta content="Nicholas Payne" name="og:author" property="og:author"/>
  <meta content="Nicholas Payne" name="og:site_name" property="og:site_name"/>
  <meta content="#3A5895" name="theme-color"/>
  <meta content="Nicholas Payne" name="og:author" property="og:author"/>
  <meta content="pypeaday@pm.me" name="og:author_email" property="og:author_email"/>
  <meta content="website" name="og:type" property="og:type"/>
  <meta content="Amazon has crossed the line with me just one too many times now so we are looking to drop them like every other Big Tech provider.... However, one key feature o" name="description" property="description"/>
  <meta content="Amazon has crossed the line with me just one too many times now so we are looking to drop them like every other Big Tech provider.... However, one key feature o" name="og:description" property="og:description"/>
  <meta content="Amazon has crossed the line with me just one too many times now so we are looking to drop them like every other Big Tech provider.... However, one key feature o" name="twitter:description" property="twitter:description"/>
  <meta content="Wish-List-With-Fastapi | Pypeaday" name="og:title" property="og:title"/>
  <meta content="Wish-List-With-Fastapi | Pypeaday" name="twitter:title" property="twitter:title"/>
  <meta content="/static/images/wish-list-with-fastapi-og.png" name="og:image" property="og:image"/>
  <meta content="/static/images/wish-list-with-fastapi-og.png" name="twitter:image" property="twitter:image"/>
  <meta content="1600" name="og:image:width" property="og:image:width"/>
  <meta content="900" name="og:image:width" property="og:image:width"/>
  <meta content="summary_large_image" name="twitter:card" property="twitter:card"/>
  <meta content="Pypeaday" name="og:site_name" property="og:site_name"/>
  <meta content="@pypeaday" name="twitter:creator" property="twitter:creator"/>
  <meta content="Wish-List-With-Fastapi" name="title" property="title"/>
  <meta content="markata 0.2.0" name="generator" property="generator"/>
  <link href="https://pype.dev/wish-list-with-fastapi/" rel="canonical"/>
  <meta content="https://pype.dev/wish-list-with-fastapi/" name="og:url" property="og:url"/>
  <link href="/manifest.json" rel="manifest"/>
  <meta content="/static/images/wish-list-with-fastapi-og_250x140.png" name="og:sm_image" property="og:sm_image"/>
  <meta content="/static/images/wish-list-with-fastapi-og_250x140.png" name="og:sm_image" property="og:sm_image"/>
 </head>
 <body>
  <nav>
   <ul>
    <li>
     <a href="/">
      Home
     </a>
    </li>
    <li>
     <a href="/archive/">
      Archive
     </a>
    </li>
    <li>
     <a aria-label="RSS" href="/rss.xml">
      <svg class="icon" height="16" viewbox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
       <path d="M 4 4.44 v 2.83 c 7.03 0 12.73 5.7 12.73 12.73 h 2.83 c 0 -8.59 -6.97 -15.56 -15.56 -15.56 Z m 0 5.66 v 2.83 c 3.9 0 7.07 3.17 7.07 7.07 h 2.83 c 0 -5.47 -4.43 -9.9 -9.9 -9.9 Z M 6.18 15.64 A 2.18 2.18 0 0 1 6.18 20 A 2.18 2.18 0 0 1 6.18 15.64" fill="currentColor">
       </path>
      </svg>
     </a>
    </li>
   </ul>
  </nav>
  <article class="blog-post h-entry">
   <!-- <div id='cover-wrapper'>
      <img src='/wish-list-with-fastapi.webp' alt='cover image for article' />
    </div> -->
   <div id="title-wrapper">
    <a class="u-url" href="https://pype.dev/wish-list-with-fastapi/">
     <h1 class="flair" id="title" style="text-align:right;z-index:2;padding-right:.2rem">
      Wish-List-With-Fastapi
     </h1>
    </a>
    <p>
     <time class="dt-published post-date" datetime="2022-05-06" style="text-align:right;z-index:2">
      2022-05-06
     </time>
    </p>
    <div class="h-card p-author" rel="author">
     <div class="content">
      <a class="p-name u-url" href="https://pype.dev/">
       <p>
        <span class="p-given-name">
         Nicholas
        </span>
        <span class="p-family-name">
         Payne
        </span>
       </p>
      </a>
      <p class="p-note">
       Goofing off
       <a href="https://twitter.com/pypeaday">
        @pypeaday
       </a>
      </p>
     </div>
    </div>
    <!-- edit -->
    <p>
     <a alt="edit post url" href="https://github.com/nicpayne713/mental-data-lake/edit/main/pages/blog/wish-list-with-fastapi.md" title="edit this post">
      edit
      <span aria-label="" role="img">
       ✏️
      </span>
     </a>
    </p>
   </div>
   <!-- <h2 class='toc'>toc</h2> -->
   <!-- <div class="toc">
<ul>
<li><a href="#abcmeta">ABCMeta</a></li>
</ul>
</div>
 -->
   <div id="post-body">
    <p>
     Amazon has crossed the line with me just one too many times now so we are looking to drop them like every other Big Tech provider....
    </p>
    <p>
     However, one key feature of Amazon that has been so useful for us is Lists... We can just maintain a list for each of us and then family members can login anytime and check it out... 
This really alleviates any last minute gift idea stress right before a birthday or something.
    </p>
    <p>
     So I need a nice gift list service but I don't want to be locked into one company (like a Target registry or something) and I'd like to host it myself
    </p>
    <p>
     The internets had a few options but nothing looked/felt like I wanted to I decided to build my own.
    </p>
    <h1 id="the-frontend">
     The Frontend
     <a alt="id" class="heading-permalink" href="#the-frontend" title="link to #the-frontend">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h1>
    <p>
     <strong>
      I have no idea how to do front end so stay tuned
     </strong>
    </p>
    <h1 id="the-backend">
     The Backend
     <a alt="id" class="heading-permalink" href="#the-backend" title="link to #the-backend">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h1>
    <p>
     FastAPI for the win on this one... I followed a few examples online and what I was able to build in just a few minutes is pretty impressive thanks to the design of FastAPI.
    </p>
    <p>
     Some key features are:
1. Auto doc generation
2. Required typing (which makes #1 possible)
3. Built-in api testing in the browser
4. Easy integration with sqlalchemy
5. Development time so short you won't be done with your coffee before having something up and running!
    </p>
    <h2 id="database">
     Database
     <a alt="id" class="heading-permalink" href="#database" title="link to #database">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h2>
    <p>
     Starting with a simple
     <code>
      database.py
     </code>
     we can create a sqlalchemy session with a base model with about 7 lines of code...
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>


<span class="n">SQLALCHEMY_DATABASE_URL</span> <span class="o">=</span> <span class="s2">"sqlite:///wishes.sqlite3"</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URL</span><span class="p">)</span>
<span class="n">SessionLocal</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">autocommit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">autoflush</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
</code></pre>
    </div>
    <h2 id="model">
     Model
     <a alt="id" class="heading-permalink" href="#model" title="link to #model">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h2>
    <p>
     For my wish list I needed just a simple table:
    </p>
    <table>
     <thead>
      <tr>
       <th align="right">
        id
       </th>
       <th align="left">
        person
       </th>
       <th align="left">
        item
       </th>
       <th align="left">
        link
       </th>
       <th align="left">
        purchased
       </th>
       <th align="left">
        purchased_by
       </th>
       <th align="left">
        date_added
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="right">
        1
       </td>
       <td align="left">
        pypeaday
       </td>
       <td align="left">
        A sweet item
       </td>
       <td align="left">
        <a href="http://www.mystore.store">
         www.mystore.store
        </a>
       </td>
       <td align="left">
        False
       </td>
       <td align="left">
        dad
       </td>
       <td align="left">
        2022-05-05 21:55:09
       </td>
      </tr>
      <tr>
       <td align="right">
        2
       </td>
       <td align="left">
        pypeaday
       </td>
       <td align="left">
        A bitter item
       </td>
       <td align="left">
        <a href="http://www.bitterstore.com">
         www.bitterstore.com
        </a>
       </td>
       <td align="left">
        True
       </td>
       <td align="left">
        Mrs. pypeaday
       </td>
       <td align="left">
        2022-05-06 06:55:54
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     The table is simple enough... A unique key, the person who the wish belongs to, the item (or wish), a link to the item, whether it's been purchased or not and by whom, and the date it was added.
    </p>
    <p>
     To make this model with sqlalchemy we can make a
     <code>
      model.py
     </code>
     like so:
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="kn">from</span> <span class="nn">database</span> <span class="kn">import</span> <span class="n">Base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.schema</span> <span class="kn">import</span> <span class="n">Column</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="kn">import</span> <span class="n">Boolean</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Text</span>


<span class="k">class</span> <span class="nc">Wishes</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">"Wishes"</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Text</span><span class="p">())</span>
    <span class="n">link</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Text</span><span class="p">())</span>
    <span class="n">purchased</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Boolean</span><span class="p">())</span>
    <span class="n">purchased_by</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">90</span><span class="p">))</span>
    <span class="n">date_added</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
</code></pre>
    </div>
    <h2 id="schema">
     Schema
     <a alt="id" class="heading-permalink" href="#schema" title="link to #schema">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h2>
    <p>
     One of the best things about FastAPI is trivial integration with pydantic.
We can define a schema to ensure any data posted is not missing anything!
    </p>
    <p>
     Make a
     <code>
      schema.py
     </code>
     with the following:
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>


<span class="k">class</span> <span class="nc">wish_schema</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>

    <span class="n">person</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">link</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">purchased</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">purchased_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">date_added</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S"</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">orm_mode</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">class</span> <span class="nc">patch_schema</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>

    <span class="n">purchased</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">purchased_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">orm_mode</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre>
    </div>
    <p>
     I have 2 schemas - one for a
     <code>
      wish
     </code>
     which you'll see down below is used to validate any
     <code>
      post
     </code>
     requests.
    </p>
    <p>
     To simplify things for me I made another schema,
     <code>
      patch_schema
     </code>
     which I use for the route that updates the table (ie. marking an existing wish as purchased)
    </p>
    <h2 id="session">
     Session
     <a alt="id" class="heading-permalink" href="#session" title="link to #session">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h2>
    <p>
     One of the last things we need is a Session
    </p>
    <p>
     So make a
     <code>
      session.py
     </code>
     ...
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="kn">from</span> <span class="nn">database</span> <span class="kn">import</span> <span class="n">SessionLocal</span><span class="p">,</span> <span class="n">engine</span>
<span class="kn">import</span> <span class="nn">model</span>

<span class="n">model</span><span class="o">.</span><span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">create_get_session</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">SessionLocal</span><span class="p">()</span>
        <span class="k">yield</span> <span class="n">db</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
    </div>
    <p>
     Our routes will depend on this
     <code>
      create_get_session
     </code>
     function that will yield a
     <code>
      db
     </code>
     object through which we'll udpate our database
    </p>
    <h1 id="ok-just-do-it-already">
     Ok just do it already!
     <a alt="id" class="heading-permalink" href="#ok-just-do-it-already" title="link to #ok-just-do-it-already">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h1>
    <p>
     So our
     <code>
      main.py
     </code>
     will have a few routes in it...
    </p>
    <p>
     What do we want to support?
    </p>
    <ol>
     <li>
      Getting all wishes
     </li>
     <li>
      Getting a specific wish
     </li>
     <li>
      Updating a specific wish
     </li>
     <li>
      Deleting a wish
     </li>
    </ol>
    <p>
     I think the script is fairly self explanatory but here's a few notes...
    </p>
    <ol>
     <li>
      We decorate each function with
      <code>
       @app.&lt;method&gt;
      </code>
      and define
      <code>
       response_model
      </code>
      as well as
      <code>
       status_code
      </code>
     </li>
     <li>
      The functions are defined with
      <code>
       async
      </code>
      (this was my first exposure to this so I can't go in depth on it yet)
     </li>
     <li>
      The functions all take a
      <code>
       db
      </code>
      which is from
      <code>
       session.py
      </code>
      and that
      <code>
       db
      </code>
      depends on the
      <code>
       create_get_session
      </code>
      function
     </li>
     <li>
      If the db is being updtes then we type the object used for the update with the appropriate schema (either
      <code>
       wish_schema
      </code>
      or
      <code>
       patch_schema
      </code>
      )
     </li>
    </ol>
    <p>
     From there we're in true python-land where you can basically guess the methods on
     <code>
      db
     </code>
     and you'd probably be right... (like
     <code>
      query
     </code>
     ,
     <code>
      upddate
     </code>
     ,
     <code>
      delete
     </code>
     etc.)
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">HTTPException</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">model</span> <span class="kn">import</span> <span class="n">Wishes</span>
<span class="kn">from</span> <span class="nn">schema</span> <span class="kn">import</span> <span class="n">wish_schema</span><span class="p">,</span> <span class="n">patch_schema</span>
<span class="kn">from</span> <span class="nn">session</span> <span class="kn">import</span> <span class="n">create_get_session</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_root</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">"message"</span><span class="p">:</span> <span class="s2">"server is up!"</span><span class="p">}</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/wishes"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">wish_schema</span><span class="p">],</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">read_wishes</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">create_get_session</span><span class="p">)):</span>
    <span class="n">wishes</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Wishes</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">wishes</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"/wishes"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">wish_schema</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">add_wish</span><span class="p">(</span><span class="n">wish</span><span class="p">:</span> <span class="n">wish_schema</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">create_get_session</span><span class="p">)):</span>
    <span class="n">new_wish</span> <span class="o">=</span> <span class="n">Wishes</span><span class="p">(</span>
        <span class="n">person</span><span class="o">=</span><span class="n">wish</span><span class="o">.</span><span class="n">person</span><span class="p">,</span>
        <span class="n">item</span><span class="o">=</span><span class="n">wish</span><span class="o">.</span><span class="n">item</span><span class="p">,</span>
        <span class="n">link</span><span class="o">=</span><span class="n">wish</span><span class="o">.</span><span class="n">link</span><span class="p">,</span>
        <span class="n">purchased</span><span class="o">=</span><span class="n">wish</span><span class="o">.</span><span class="n">purchased</span><span class="p">,</span>
        <span class="n">purchased_by</span><span class="o">=</span><span class="n">wish</span><span class="o">.</span><span class="n">purchased_by</span><span class="p">,</span>
        <span class="n">date_added</span><span class="o">=</span><span class="n">wish</span><span class="o">.</span><span class="n">date_added</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_wish</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">new_wish</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/wishes/</span><span class="si">{id}</span><span class="s2">"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">wish_schema</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_wish</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">create_get_session</span><span class="p">)):</span>
    <span class="n">wish</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Wishes</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wish</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">"/wishes/</span><span class="si">{id}</span><span class="s2">"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">wish_schema</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">update_wish</span><span class="p">(</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">patch</span><span class="p">:</span> <span class="n">patch_schema</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">create_get_session</span><span class="p">)</span>
<span class="p">):</span>
    <span class="n">db_wish</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Wishes</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">db_wish</span><span class="o">.</span><span class="n">purchased</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">purchased</span>
    <span class="n">db_wish</span><span class="o">.</span><span class="n">purchased_by</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">purchased_by</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">db_wish</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">db_wish</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">"/wishes/</span><span class="si">{id}</span><span class="s2">"</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">delete_wish</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">create_get_session</span><span class="p">)):</span>
    <span class="n">db_wish</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Wishes</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">db_wish</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="s2">"404"</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">"Wish id does not exist"</span><span class="p">)</span>

    <span class="n">db</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">db_wish</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre>
    </div>
    <h1 id="my-code">
     My Code
     <a alt="id" class="heading-permalink" href="#my-code" title="link to #my-code">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h1>
    <p>
     You can find my repo
     <a href="https://github.com/nicpayne713/wish-lists">
      here
     </a>
     .
    </p>
    <p>
     I'll plan to update and maintain for as long as I use it
    </p>
   </div>
   <hr/>
   <div id="show">
   </div>
  </article>
  <footer>
   <ul class="social">
    <li>
     <a href="https://twitter.com/pypeaday">
      twitter
     </a>
    </li>
    <li>
     <a href="https://www.linkedin.com/in/nicpayne713/">
      LinkedIn
     </a>
    </li>
    <li>
     <a href="https://github.com/nicpayne713">
      GitHub
     </a>
    </li>
    <li>
     <a href="https://www.twitch.tv/pypeaday">
      twitch
     </a>
    </li>
   </ul>
   <p>
    © 2022 - 2022
   </p>
  </footer>
 </body>
</html>